<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ self.page_title() if self is defined else 'Clinic Finance' }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body { background: #f2f4f7; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }

        /* SIDEBAR ======================= */
        .sidebar {
            position: fixed; inset: 0 auto 0 0; width: 260px; height: 100vh;
            padding: 18px 18px 16px; display: flex; flex-direction: column;
            color: #e5ecff;
            background: radial-gradient(circle at top left, #3b82f6 0, #1d4ed8 30%, #020617 90%);
            box-shadow: 4px 0 18px rgba(15,23,42,.25);
            border-right: 1px solid rgba(148,163,184,.35); z-index:1000;
        }

        .sidebar-brand { display:flex; align-items:center; gap:10px; padding:4px 4px 12px; border-bottom:1px solid rgba(148,163,184,.35); margin-bottom:12px; }
        .sidebar-brand-icon { width:34px; height:34px; border-radius:12px; background:rgba(15,23,42,.55); display:flex; align-items:center; justify-content:center; font-size:19px; color:#bfdbfe; }
        .sidebar-brand-title { font-weight:600; font-size:16px; color:#f9fafb; }
        .sidebar-brand-sub { font-size:11px; color:#cbd5f5; }

        .sidebar-nav { flex:1; margin-top:8px; overflow-y:auto; padding-right:4px; }
        .sidebar-section-title { font-size:11px; text-transform:uppercase; letter-spacing:.08em; color:#9fb4ff; padding:10px 10px 4px; }

        .sidebar .nav-link {
            color:#e5ecff; padding:8px 12px; font-size:14px; border-radius:10px;
            display:flex; align-items:center; gap:8px; position:relative; margin:2px 6px;
            transition: background .15s ease, color .15s ease, transform .05s ease;
        }
        .sidebar .nav-link i { font-size:16px; opacity:.9; }
        .sidebar .nav-link.active { background: linear-gradient(90deg, rgba(248,250,252,.2), rgba(59,130,246,.35)); color:#fff; font-weight:600; }
        .sidebar .nav-link.active::before { content:""; position:absolute; left:-4px; top:9px; bottom:9px; width:3px; border-radius:999px; background:#facc15; }
        .sidebar .nav-link:hover { background: rgba(15,23,42,.35); color:#fff; transform:translateX(1px); }

        .sidebar-footer { padding-top:8px; margin-top:4px; border-top:1px solid rgba(148,163,184,.35); font-size:11px; color:#cbd5f5; display:flex; justify-content:space-between; align-items:center; }
        .sidebar-role-badge { padding:2px 8px; border-radius:999px; background:rgba(15,23,42,.6); border:1px solid rgba(148,163,184,.6); font-size:10px; text-transform:uppercase; letter-spacing:.08em; }
        .sidebar-user { font-size:11px; }

        /* CONTENT ================== */
        .content-area { padding:25px; }
        .has-sidebar .content-area { margin-left:260px; }
        .page-header-main h3 { font-weight:600; }
    </style>
</head>

<body class="{% if g.user %}has-sidebar{% endif %}">

{% if g.user %}
<div class="sidebar">
    <!-- Brand -->
    <div class="sidebar-brand">
        <div class="sidebar-brand-icon"><i class="bi bi-hospital"></i></div>
        <div>
            <div class="sidebar-brand-title">Clinic Finance</div>
            <div class="sidebar-brand-sub">Asia Doctor's Point</div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="sidebar-nav">

        <div class="sidebar-section-title">Overview</div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}"
                   href="{{ url_for('dashboard') }}">
                    <i class="bi bi-speedometer2"></i><span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'change_password' %}active{% endif %}"
                   href="{{ url_for('change_password') }}">
                    <i class="bi bi-key"></i><span>Change Password</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'report' %}active{% endif %}"
                   href="{{ url_for('report') }}">
                    <i class="bi bi-file-earmark-bar-graph"></i><span>Reports</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-section-title">Daily Finance</div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'bulk_expense' %}active{% endif %}"
                   href="{{ url_for('bulk_expense') }}">
                    <i class="bi bi-receipt"></i><span>Add Expense</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'add_day' %}active{% endif %}"
                   href="{{ url_for('add_day') }}">
                    <i class="bi bi-cash-coin"></i><span>Add Collection</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'lab_collection' %}active{% endif %}"
                   href="{{ url_for('lab_collection') }}">
                    <i class="bi bi-bezier2"></i><span>Collection from Lab</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'bank' %}active{% endif %}"
                   href="{{ url_for('bank') }}">
                    <i class="bi bi-bank"></i><span>Bank Balance</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-section-title">People & Vendors</div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint in ['staffs','staff_history'] %}active{% endif %}"
                   href="{{ url_for('staffs') }}">
                    <i class="bi bi-people"></i><span>Staff Salary</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint in ['suppliers','supplier_history'] %}active{% endif %}"
                   href="{{ url_for('suppliers') }}">
                    <i class="bi bi-truck"></i><span>Suppliers</span>
                </a>
            </li>
        </ul>

        {% if g.user.role in ['admin','superadmin'] %}
        <div class="sidebar-section-title">Admin</div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'expense_templates' %}active{% endif %}"
                   href="{{ url_for('expense_templates') }}">
                    <i class="bi bi-sliders"></i><span>Create Expense</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'delete_history' %}active{% endif %}"
                   href="{{ url_for('delete_history') }}">
                    <i class="bi bi-eraser"></i><span>Delete History</span>
                </a>
            </li>
            {% if g.user.role == 'superadmin' %}
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint == 'manage_users' %}active{% endif %}"
                   href="{{ url_for('manage_users') }}">
                    <i class="bi bi-person-plus"></i><span>Manage Users</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if request.endpoint in ['superadmin_panel', 'edit_expense'] %}active{% endif %}"
                   href="{{ url_for('superadmin_panel') }}">
                    <i class="bi bi-shield-lock"></i><span>SuperAdmin Panel</span>
                </a>
            </li>
            {% endif %}
        </ul>
        {% endif %}

    </div>

    <div class="sidebar-footer">
        <div class="sidebar-user">{{ g.user.username }}</div>
        <div class="sidebar-role-badge">{{ g.user.role|upper }}</div>
    </div>
</div>
{% endif %}

<div class="content-area">
    <div class="d-flex justify-content-between align-items-center mb-3 page-header-main">
        <div>
            <h3>{% block page_title %}Clinic Finance{% endblock %}</h3>
            <div>{% block page_subtitle %}{% endblock %}</div>
        </div>
        <div>
            {% if g.user %}
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-primary">Logout</a>
            {% endif %}
        </div>
    </div>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="alert alert-info">
                {% for msg in messages %}<div>{{ msg }}</div>{% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
